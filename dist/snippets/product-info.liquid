{%- capture product_form_id -%}product-form-{{ section.id }}-{{ product.id }}{%- endcapture -%}

<div class="product__info position-sticky mt-4 fb-md:mt-6 fb-md:min-h-[680px] fb-md:flex fb-md:flex-col fb-md:justify-center">
  <!-- PRODUCT META -->
  <product-meta form-id="{{ product_form_id }}" price-class="" class="product-meta">
    <div class="w-full flex items-center justify-start space-x-3 mb-1.5 fb-md:mb-2.5">
      {%- if product.metafields.product.brand.value != blank
        and product.metafields.product.brand.value != 'null'
        and product.metafields.product.brand.value != '-'
      -%}
        <div class="text-121212  fb-max-sm:text-14 text-16 line-clamp-1">
          {{ product.metafields.product.brand }}
        </div>
        <div class="h-3.5 w-0 border-l border-142A6B">
        </div>
      {% endif %}
        <div
          class="text-121212  fb-max-sm:text-14 text-16 line-clamp-1"
          {% if product.metafields.product.manufacturer_model_number == blank %}
            style="display: none"
          {% endif %}
          data-product-sku-container
        >
          <span>Model:</span>
          <span class="product-meta__sku-number" data-product-sku-number>
            {{- product.metafields.product.manufacturer_model_number -}}
          </span>
        </div>
    </div>
    <div class="mb-5 fb-md:mb-6.5">
      {% unless featured %}
        <h1 class=" text-20  font-bold text-121212 fb-md:text-26">{{ product.title }}</h1>
      {% else %}
        <h2 class=" text-20 font-bold text-121212 fb-md:text-26">
          <a href="{{ product.url }}">{{ product.title }}</a>
        </h2>
      {% endunless %}
      <div class="sky-single-reviews hidden cursor-pointer mt-1.5 fb-md:mt-2.5"></div>
     </div>
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when '@app' -%}
           {%- render block -%}
      {%- endcase -%}
    {%- endfor -%}
    {% comment %} discount block - table style {% endcomment %}
    <div class="mb-4 w-full">
      <div class="overflow-x-auto grary-scrollerbar overflow-y-hidden pb-4 fb-sm:pb-0">
        {%- assign b2b_catalog = false -%}
        {% if customer and customer.current_company and customer.current_company.metafields.b2b.show_catalog_price %}
          {%- assign b2b_catalog = customer.current_company.metafields.b2b.show_catalog_price -%}
        {% endif %}
        {%- assign moq = product.metafields.product.moq | default: 1 | plus:0   -%}
        {% if product.metafields.product.quantity_discount != blank and product.metafields.product.quantity_discount.value.size != 0 and b2b_catalog == false %}
          <table class="w-full border-collapse rounded-sm relative z-1">
            <thead class="border border-main">
              <tr class="bg-main h-10 font-bold text-14 fb-md:text-14 text-white">
                <th class="text-center px-0.5 h-full min-w-27 border border-main sticky left-0 bg-main z-2">
                  QUANTITY 
                </th>
                {%- assign first_discount_moq_minus_one = product.metafields.product.quantity_discount.value[0].moq | minus: 1  | plus:0 -%}
               <th class="text-center px-0.5 h-full border border-main   {% if moq > first_discount_moq_minus_one  %} hidden {% endif} %} ">
                
                  {% if moq>= 1  and  moq<=  first_discount_moq_minus_one %}
                    {{ moq }}+
                    {% else %}
                    {{ 1 }}+
                  {% endif %}
                  {% comment %} 1 - {{ product.metafields.product.quantity_discount.value[0].moq | minus: 1 }} {% endcomment %}
                </th>
                {% assign last_item_index = product.metafields.product.quantity_discount.value.size | minus: 1 | plus: 1%}
                {% for item in product.metafields.product.quantity_discount.value %}
                  {% if forloop.index != last_item_index %}
                    {%- assign item_moq = item.moq | plus: 0 -%}
                    {%- assign next_item_moq = product.metafields.product.quantity_discount.value[forloop.index].moq | plus: 0 -%}
                    <th class="text-center px-0.5 h-full border border-main {% if moq>= next_item_moq  %} hidden {% endif} %}">
                      
                      {% if forloop.index < product.metafields.product.quantity_discount.value.size %}
                        {% if moq >= item_moq %}
                          {{ moq }}+
                        {% else %}
                          {{ item.moq }}+
                        {% endif %}
                      {% endif %}
                    </th>
                  {% else %}
                  {%- assign last_item_moq = item.moq | plus: 0 -%}
                  {% if last_item_moq < moq %}
                    <th class="text-center px-0.5 h-full border border-main">
                     {{ moq }}+
                    </th>
                  {% else %}
                  <th class="text-center px-0.5 h-full border border-main">
                      {{ item.moq }}+
                    </th>
                {% endif %}
                  {% endif %}
                {% endfor %}  
              </tr>
            </thead>
            <tbody class="border border-E2E2E2">
              <tr class="text-32 text-main py-3 h-14">
                <td class="text-center px-0.5 text-14 fb-md:text-14 font-normal text-121212 border-l border-E2E2E2 bg-F9F9F9 sticky left-0 z-2">
                  Price per<br>{{ product.metafields.product.sale_package.value }}
                </td>
                <td class="js-discount-space px-4 text-center border-l border-E2E2E2  {% if moq > first_discount_moq_minus_one  %} hidden {% endif} %} discount-price-selected" data-min="1" data-max="{{ product.metafields.product.quantity_discount.value[0].moq | minus: 1 }}">
                  <div class="">
                    {%- assign dis_price = product.selected_or_first_available_variant.price -%}
                    {% render 'format-price', price: dis_price %}
                  </div>
                </td>
                {% for item in product.metafields.product.quantity_discount.value %}
                  {% if forloop.index != last_item_index %}
                    {%- assign item_moq = item.moq | plus: 0 -%}
                    {%- assign next_item_moq = product.metafields.product.quantity_discount.value[forloop.index].moq | plus: 0 -%}
                    <td class="js-discount-space px-4 text-center border-l border-E2E2E2 {% if moq>= next_item_moq %} hidden {% endif} %}" data-min="{{ item.moq }}" data-max="{{ product.metafields.product.quantity_discount.value[forloop.index].moq | minus: 1 }}">
                      <div class="">
                        {%- assign discount_price = item.discount | times: 100 -%}
                        {% render 'format-price', price: discount_price %}
                      </div>
                    </td>
                  {% else %}
                    <td class="js-discount-space px-4 text-center border-l border-E2E2E2" data-min="{{ item.moq }}">
                        <div class="">
                          {%- assign discount_price_more = item.discount | times: 100 -%}
                          {% render 'format-price', price: discount_price_more %}
                        </div>
                    </td>
                  {% endif %}
                {% endfor %}
              </tr>
            </tbody>
          </table>
        {% else %}
          <div class="text-32 font-bold text-main">
              {%- assign dis_price = product.selected_or_first_available_variant.price -%}
              {% render 'format-price', price: dis_price %}
          </div>
        {% endif %}
      </div>
      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
        <div class="w-full flex items-center justify-start space-x-2 mt-1">
          <span class="text-16 text-808080 line-through">
            <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
            {%- if settings.currency_code_enabled -%}
              {{- product.selected_or_first_available_variant.compare_at_price | money_with_currency -}}
            {%- else -%}
              {{- product.selected_or_first_available_variant.compare_at_price | money -}}
            {%- endif -%}
          </span>
          {% assign price = product.price | money_without_currency | replace: ',', '' | times: 1 %}
          {% assign compare_at_price = product.compare_at_price
            | money_without_currency
            | replace: ',', ''
            | times: 1
          %}
          {% assign discount_difference = compare_at_price | minus: price %}
          {% assign discount_percentage = discount_difference | divided_by: compare_at_price | times: 100.0 | round %}
          <span class="text-red-600 text-14 font-bold">{{ discount_percentage }}% OFF</span>
        </div>
      {%- endif -%}
      {% comment %} <product-payment-terms form-id="{{ product_form_id }}">
      {%- assign product_installment_form_id = 'product-installment-form-'
        | append: section.id
        | append: '-'
        | append: product.id
      -%}

      {%- form 'product', product, id: product_installment_form_id -%}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        {{- form | payment_terms -}}
      {%- endform -%}
      </product-payment-terms> {% endcomment %}
    </div>
    {% comment %} compare block {% endcomment %}

    {% assign unit_sale = product.metafields.product.sale_unit.value %}
    {% if unit_sale != blank %}
      {% assign unit_sale = unit_sale | split: ':' %}
      {% assign unit_sale = unit_sale.first %}
    {% endif %}
    {% if product.metafields.custom.product_variants != blank %}
      <div class="product_variants-box">
        <div class="title">Overall Length</div>
        <div class="product_variants-list">
          {{ product.metafields.custom.product_variants | metafield_tag | newline_to_br }}
        </div>
      </div>
    {% endif %}

    {%- if section.settings.show_taxes_included -%}
      {%- if cart.taxes_included or shop.shipping_policy.body != blank -%}
        <p class="product-meta__taxes-included text--small">
          {%- if cart.taxes_included -%}
            {{ 'product.general.include_taxes' | t }}
          {%- endif -%}

          {%- if shop.shipping_policy.body != blank -%}
            {{ 'product.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
          {%- endif -%}
        </p>
      {%- endif -%}
    {%- endif -%}
  </product-meta>
  {%- render 'product-attrs', product: product -%}
  {%- render 'product-form', product: product, update_url: update_url -%}
  {%- render 'product-truest', product: product -%}
  {%- render 'product-features', product: product -%}
</div>



