$(function(){const getInitPrice=()=>{let basePrice=$("#js-nav-quick").data("price")||0;if(basePrice){basePrice=typeof basePrice=="string"?parseFloat(basePrice.replace(/,/g,"")):parseFloat(basePrice)}return basePrice};const mainProductInfo={info:{price:getInitPrice(),moq:$(".js-zkh-input").data("moq")||1,mpq:$(".js-zkh-input").data("mpq")||1,discountJson:mainProductUtils.formateDiscountJson("#js-nav-quick"),variantId:$("#js-nav-quick").data("variant-id"),quantity:$(".js-zkh-input").data("moq")||1,sku:$("#js-product-quikbuy").data("sku")||""}};const productNavBar={gumshoeInstance:null,currentSelectedItem:null,showSection:[{ele:".js-highlights-section",isShow:true,id:"js-highlights-section",desc:"Highlights",pcCategorize:"Product Highlights",categorize:"Highlights"},{ele:".js-addition-detail",isShow:true,id:"js-addition-section",desc:"Details",pcCategorize:"Additional Details",categorize:"Details"},{ele:".js-download-file",isShow:true,id:"js-download-section",desc:"Files",pcCategorize:"User Documents",categorize:"Files"},{ele:".js-brand-about",isShow:true,id:"js-brand-section",desc:"Brand",pcCategorize:"About the Brand",categorize:""},{ele:".js-review-rate",isShow:true,id:"js-review-section",desc:"Reviews",pcCategorize:"See Reviews",categorize:"Reviews"}],init:function(){this.renderNavTitle();this.initGumshoe()},renderNavTitle:function(){let str="";let getArr=[];let str_css="text-white fb-sm:text-121212 text-14 fb-sm:text-16 fb-1700:text-18 cursor-pointer shrink-0 fb-1700:w-11r h-full items-center justify-center";this.showSection.forEach((item,index)=>{const $dom=$(item.ele);if($dom.length){$dom.attr("id",item.id);getArr.push(item);const visibilityClass=item.categorize?item.isShow?"flex":"hidden":item.isShow?"hidden fb-sm:flex":"hidden";str+=`<li class="js-nav-box ${str_css} ${visibilityClass}">
            <a href="#${item.id}" class="js-nav-choose h-full flex items-center justify-center" data-desc="${item.desc}">
              <span class="hidden fb-sm:inline">${item.pcCategorize}</span>
              <span class="fb-sm:hidden">${item.categorize}</span>
            </a>
          </li>`}});$(".js-product-anchor").html(str);if(getArr.length===1&&!getArr[0].categorize){$(".js-anchor-section").addClass("hidden fb-sm:block")}if(getArr.length===0){$(".js-anchor-section").hide()}},initGumshoe:function(){if(this.gumshoeInstance&&typeof this.gumshoeInstance.destroy==="function"){this.gumshoeInstance.destroy()}this.gumshoeInstance=new Gumshoe(".js-nav-choose",{offset:80,reflow:true,nested:true,throttle:30,callback:nav=>{if(!nav)return;$(".js-product-anchor li").removeClass("active");$(nav).parent().addClass("active");this.currentSelectedItem=$(nav).attr("href")}})}};const pdpAddCart={quantity:1,productInfo:null,init:function(){this.productInfo=Object.assign({},mainProductInfo.info);this.quantity=this.productInfo.moq;this.getTotalMoney();this.bindEvents()},getTotalMoney:function(){const finalPrice=QuantityUtils.calculateTotalPrice(this.productInfo,this.quantity);$(".js-nav-current-price").html(finalPrice);document.dispatchEvent(new CustomEvent("quantitySelectorUpdated",{detail:this.quantity}))},decreaseQuantity:function(){const self=this;this.quantity=QuantityUtils.decreaseQuantity({$input:$(".js-zkh-input"),$plusBtn:$(".js-zkh-plus"),$minusBtn:$(".js-zkh-minus"),productInfo:this.productInfo,onQuantityChange:function(newQuantity){self.quantity=newQuantity;self.getTotalMoney();$(".js-zkh-input").attr("data-demand",newQuantity)}})},increaseQuantity:function(){const self=this;this.quantity=QuantityUtils.increaseQuantity({$input:$(".js-zkh-input"),$plusBtn:$(".js-zkh-plus"),$minusBtn:$(".js-zkh-minus"),productInfo:this.productInfo,onQuantityChange:function(newQuantity){self.quantity=newQuantity;self.getTotalMoney();$(".js-zkh-input").attr("data-demand",newQuantity)}})},bindEvents:function(){const self=this;$(".js-zkh-addtocart").click(function(){let $btn=$(this);const $input=$(".js-zkh-input");$btn.find(".js-btn-text").addClass("hidden");$btn.find(".js-btn-loading").removeClass("hidden");cartFormModule.addToCart({variantId:self.productInfo.variantId,quantity:$input.val()||self.quantity},function(){$btn.find(".js-btn-text").removeClass("hidden");$btn.find(".js-btn-loading").addClass("hidden")})});$(".js-zkh-plus").click(function(){self.increaseQuantity()});$(".js-zkh-minus").click(function(){self.decreaseQuantity()});QuantityUtils.bindInputChangeEvent({$input:$(".js-zkh-input"),$plusBtn:$(".js-zkh-plus"),$minusBtn:$(".js-zkh-minus"),productInfo:self.productInfo,onQuantityChange:function(newQuantity){self.quantity=newQuantity;$(".js-zkh-input").val(newQuantity);$(".js-zkh-input").attr("data-demand",newQuantity);self.getTotalMoney()}})}};productNavBar.init();pdpAddCart.init();function newQuickBuy(){if(document.getElementById("js-product-quikbuy")){new Vue({el:"#js-product-quikbuy",delimiters:["${","}"],data(){return{sku:mainProductInfo.info.sku,selectionAttrs:[],availableAttrs:[],selectedValues:[],productInfo:{model:"",brand:"",image:"",price:0,salesUnit:"",moq:1,mpq:1,sku:"",variantId:"",discountJson:[]},productId:"",quantity:1,loading:false}},computed:{shouldHideAttributeSelector(){return this.selectionAttrs.find(item=>item.attrName==="match")||this.selectionAttrs.length===0||this.selectionAttrs.length===1&&this.selectionAttrs[0].values.length<=1},formattedPrice(){return this.productInfo?.price?parseFloat(this.productInfo.price).toFixed(2):""},totalPrice(){return QuantityUtils.calculateTotalPrice(this.productInfo,this.quantity,"price1")},isDisabled(){const requiredCount=this.selectionAttrs.length;const validSelections=this.selectedValues.slice(0,requiredCount).filter(val=>val&&val!=="");if(validSelections.length<requiredCount)return true;return!this.availableAttrs.some(item=>item.attrs?.slice(0,requiredCount).every((attr,i)=>attr===this.selectedValues[i]))},showViewDetails(){return this.productInfo?.skuCode&&this.productInfo.skuCode!==this.productId}},async created(){await this.init()},methods:{async init(){if(this.sku){await this.getSelectionAttrs()}},async getSelectionAttrs(){try{const res=await kkAjax.get(`/spu/selection-attrs/other?sku=${this.sku}`);if(res.code===200&&res.data){this.selectionAttrs=res.data.selectionAttrs||[];this.availableAttrs=res.data.availableAttrs||[];if(this.shouldHideAttributeSelector){return false}const matchedProduct=this.availableAttrs.find(item=>item.skuCode==this.sku);this.selectedValues=new Array(this.selectionAttrs.length).fill("");this.getProductData(matchedProduct);this.calculateCurrentSkuAttrs()}}catch(err){console.error("Failed to fetch selection attributes:",err)}},getProductData(info){this.productInfo={...info,moq:parseInt(info.moq)||1,mpq:parseInt(info.mpq)||1,sku:info.skuCode||"",image:info.image||"",brand:info.brand||"",model:info.model||"",price:info.price||0,salesUnit:info.salesUnit||"",variantId:info.variantId||"",discountJson:info.quantityDiscount||[]};this.quantity=this.productInfo.moq},calculateCurrentSkuAttrs(){if(!this.productInfo?.sku||!this.availableAttrs?.length)return;const currentSkuAttrs=this.availableAttrs.find(item=>item.skuCode===this.productInfo.sku);if(currentSkuAttrs?.attrs){this.selectedValues=[...currentSkuAttrs.attrs]}},getOptionsHtml(attr,attrIndex){if(!attr?.values)return[];if(attrIndex===0)return attr.values;if(attrIndex===1&&this.selectedValues[0]){const availableValues=this.getAvailableValuesForSecondAttr();return attr.values.filter(value=>availableValues.includes(value))}return[]},getAvailableValuesForSecondAttr(){if(!this.availableAttrs?.length||!this.selectedValues[0])return[];return this.availableAttrs.filter(item=>item.attrs?.[0]===this.selectedValues[0]).map(item=>item.attrs[1]).filter(Boolean)},isOptionDisabled(value,attrIndex){if(!this.availableAttrs?.length)return false;if(attrIndex===0){if(this.selectedValues[1]){return!this.availableAttrs.some(item=>item.attrs?.[0]===value&&item.attrs?.[1]===this.selectedValues[1])}return!this.availableAttrs.some(item=>item.attrs?.[0]===value)}if(attrIndex===1){if(this.selectedValues[0]){return!this.availableAttrs.some(item=>item.attrs?.[0]===this.selectedValues[0]&&item.attrs?.[1]===value)}return!this.availableAttrs.some(item=>item.attrs?.[1]===value)}return false},onFirstSelectChange(value){this.selectedValues[0]=value;if(this.selectedValues[1]&&value){const isCompatible=this.availableAttrs.some(item=>item.attrs?.[0]===value&&item.attrs?.[1]===this.selectedValues[1]);if(!isCompatible)this.selectedValues[1]=""}if(value&&this.selectedValues[1])this.checkAndRedirectToSku()},onSecondSelectChange(value){this.selectedValues[1]=value;if(this.selectedValues[0]&&value){const isCompatible=this.availableAttrs.some(item=>item.attrs?.[0]===this.selectedValues[0]&&item.attrs?.[1]===value);if(!isCompatible)this.selectedValues[0]=""}if(value&&this.selectedValues[0])this.checkAndRedirectToSku()},checkAndRedirectToSku(){const requiredCount=this.selectionAttrs.length;const validSelections=this.selectedValues.slice(0,requiredCount).filter(val=>val&&val!=="");if(validSelections.length<requiredCount)return;const matchedSku=this.availableAttrs.find(item=>{if(!item.attrs)return false;return item.attrs.slice(0,requiredCount).every((attr,i)=>attr===this.selectedValues[i])});if(matchedSku?.skuCode)this.getProductData(matchedSku)},increaseQuantity(){const moq=this.productInfo?.moq||1;const mpq=this.productInfo?.mpq||1;const maxQuantity=1e6;let newValue=this.quantity+mpq;if(newValue>maxQuantity){newValue=maxQuantity}this.quantity=newValue},decreaseQuantity(){const moq=this.productInfo?.moq||1;const mpq=this.productInfo?.mpq||1;let newValue=this.quantity-mpq;if(newValue<moq){newValue=moq}this.quantity=newValue},onQuantityInputChange(){const moq=this.productInfo?.moq||1;const mpq=this.productInfo?.mpq||1;const maxQuantity=1e6;let inputValue=parseInt(this.quantity)||moq;if(inputValue<moq){inputValue=moq}const remainder=(inputValue-moq)%mpq;if(remainder!==0){inputValue=inputValue-remainder}if(inputValue>maxQuantity){inputValue=maxQuantity}this.quantity=inputValue},viewProductDetails(){if(this.productInfo?.sku){window.location.href=`/products/${this.productInfo.sku}`}},async addToCart(){this.loading=true;try{await cartFormModule.addToCart({variantId:this.productInfo.variantId,quantity:this.quantity})}catch(error){console.error("Add to cart failed:",error)}finally{this.loading=false}}}})}}let isInitialized=false;function throttle(fn,delay){let timer=null;let lastTime=0;return function(){const now=Date.now();if(now-lastTime>=delay){fn.apply(this,arguments);lastTime=now}}}function handleVisibility(){const quickBuyElement=$("#js-product-quikbuy");const mainPaymentContainer=$(".js-cus-product");const isMainPaymentVisible=mainPaymentContainer.length&&FbIsInViewPort(mainPaymentContainer[0]);const shouldShowQuickBuy=window.innerWidth>1700&&!isMainPaymentVisible;const tidioChat=$("#tidio-chat");if(shouldShowQuickBuy){quickBuyElement.removeClass("hidden");tidioChat.fadeOut();if(!isInitialized){isInitialized=true}}else{quickBuyElement.addClass("hidden");tidioChat.fadeIn()}const $bottomAddCart=$(".js-bottom-addcart");const isBottomCartVisible=$bottomAddCart.is(":visible");if(window.innerWidth<740){if(!isMainPaymentVisible&&!isBottomCartVisible){$bottomAddCart.fadeIn()}else if(isMainPaymentVisible&&isBottomCartVisible){$bottomAddCart.fadeOut()}}else if(window.innerWidth>740){if(isBottomCartVisible){$bottomAddCart.fadeOut()}}const header=$("#shopify-section-header");const isHeaderVisible=header.is(":visible");if(isMainPaymentVisible&&!isHeaderVisible){header.show()}else if(!isMainPaymentVisible&&isHeaderVisible){header.hide()}}handleVisibility();const throttledHandler=throttle(handleVisibility,100);$(window).on("scroll resize",throttledHandler)});