$(function(){const getInitPrice=()=>{let basePrice=$("#js-nav-quick").data("price")||0;if(basePrice){basePrice=typeof basePrice=="string"?parseFloat(basePrice.replace(/,/g,"")):parseFloat(basePrice)}return basePrice};const mainProductInfo={info:{price:getInitPrice(),moq:$(".js-nav-current-input").data("moq")||1,mpq:$(".js-nav-current-input").data("mpq")||1,discountJson:mainProductUtils.formateDiscountJson("#js-nav-quick"),variantId:$("#js-nav-quick").data("variant-id"),quantity:$(".js-nav-current-input").data("moq")||1,sku:$("#js-product-quikbuy").data("sku")||""}};const productNavBar={gumshoeInstance:null,currentSelectedItem:null,showSection:[{ele:".js-highlights-section",isShow:true,id:"js-highlights-section",desc:"Highlights",pcCategorize:"Product Highlights",categorize:"Highlights"},{ele:".js-addition-detail",isShow:true,id:"js-addition-section",desc:"Details",pcCategorize:"Additional Details",categorize:"Details"},{ele:".js-download-file",isShow:true,id:"js-download-section",desc:"Files",pcCategorize:"User Documents",categorize:"Files"},{ele:".js-brand-about",isShow:true,id:"js-brand-section",desc:"Brand",pcCategorize:"About the Brand",categorize:""},{ele:".js-review-rate",isShow:false,id:"js-review-section",desc:"Reviews",pcCategorize:"See Reviews",categorize:"Reviews"}],init:function(){this.renderNavTitle();this.initGumshoe()},renderNavTitle:function(){let str="";let getArr=[];let str_css="text-white fb-sm:text-black text-14 fb-sm:text-16 fb-1700:text-18 cursor-pointer shrink-0 fb-1700:w-11r h-full items-center justify-center";this.showSection.forEach((item,index)=>{const $dom=$(item.ele);if($dom.length){$dom.attr("id",item.id);getArr.push(item);const visibilityClass=item.categorize?item.isShow?"flex":"hidden":item.isShow?"hidden fb-sm:flex":"hidden";str+=`<li class="js-nav-box ${str_css} ${visibilityClass}">
            <a href="#${item.id}" class="js-nav-choose h-full flex items-center justify-center" data-desc="${item.desc}">
              <span class="hidden fb-sm:inline">${item.pcCategorize}</span>
              <span class="fb-sm:hidden">${item.categorize}</span>
            </a>
          </li>`}});$(".js-product-anchor").html(str);if(getArr.length===1&&!getArr[0].categorize){$(".js-anchor-section").addClass("hidden fb-sm:block")}if(getArr.length===0){$(".js-anchor-section").hide()}mainProductUtils.checkElementDisplay("#judgeme_product_reviews",1e4,function(bol){if(bol){$(".js-review-container").removeClass("invisible");$(".zkh-single-reviews").removeClass("invisible");$(".js-review-container").removeClass("h-0");$(`.js-nav-choose[data-desc='Reviews']`).closest("li").removeClass("hidden").addClass("flex")}else{$(".js-review-container").hide();$(`.js-nav-choose[data-desc='Reviews']`).closest("li").hide()}})},bindEvents:function(){},initGumshoe:function(){if(this.gumshoeInstance&&typeof this.gumshoeInstance.destroy==="function"){this.gumshoeInstance.destroy()}this.gumshoeInstance=new Gumshoe(".js-nav-choose",{offset:80,reflow:true,nested:true,throttle:30,callback:nav=>{if(!nav)return;$(".js-product-anchor li").removeClass("active");$(nav).parent().addClass("active");this.currentSelectedItem=$(nav).attr("href")}})}};const navQuickBuy={quantity:1,productInfo:null,init:function(){this.productInfo=Object.assign({},mainProductInfo.info);this.quantity=this.productInfo.moq;this.getTotalMoney();this.bindEvents()},getTotalMoney:function(){const discountJson=this.productInfo.discountJson||[];const finalPrice=cartFormModule.computed_price(discountJson,this.productInfo.price,this.quantity);$(".js-nav-current-price").html(finalPrice)},decreaseQuantity:function(){if(!this.productInfo)return;const $input=$(".js-nav-current-input");const currentValue=parseInt($input.val());const moq=this.productInfo.moq||1;const mpq=this.productInfo.mpq||1;let newValue;if(currentValue<=moq){newValue=moq}else{newValue=currentValue-mpq;if(newValue<moq){newValue=moq}}$input.val(newValue);$(".js-nav-quick-minus").prop("disabled",newValue<=moq);this.quantity=newValue;this.getTotalMoney()},increaseQuantity:function(){if(!this.productInfo)return;const $input=$(".js-nav-current-input");const currentValue=parseInt($input.val());const moq=this.productInfo.moq||1;const mpq=this.productInfo.mpq||1;const maxQuantity=cartFormModule.maxQuantity;let newValue;if(currentValue<moq){newValue=moq}else{newValue=currentValue+mpq}if(newValue>maxQuantity){newValue=maxQuantity;$(".js-nav-quick-plus").prop("disabled",true)}$input.val(newValue);$(".js-nav-quick-minus").prop("disabled",false);this.quantity=newValue;this.getTotalMoney()},bindEvents:function(){const self=this;$(".js-navquickbuy-addtocart").click(function(){let $btn=$(this);const $input=$(".js-nav-current-input");$btn.find(".js-btn-text").addClass("hidden");$btn.find(".js-btn-loading").removeClass("hidden");cartFormModule.addToCart({variantId:self.productInfo.variantId,quantity:$input.val()||self.quantity},function(){$btn.find(".js-btn-text").removeClass("hidden");$btn.find(".js-btn-loading").addClass("hidden")})});$(".js-nav-quick-plus").click(function(){self.increaseQuantity()});$(".js-nav-quick-minus").click(function(){self.decreaseQuantity()});$(".js-nav-current-input").on("change",function(){const $input=$(".js-nav-current-input");cartFormModule.validateQuantityInput($(this),self.productInfo,function(newQuantity){$(".js-nav-quick-minus").prop("disabled",newQuantity<=self.productInfo.moq);$(".js-nav-quick-plus").prop("disabled",newQuantity>=cartFormModule.maxQuantity);self.quantity=newQuantity;$input.val(newQuantity);self.getTotalMoney()})})}};const quickBuy={sku:"",selectionAttrs:[],availableAttrs:[],selectedValues:[],productInfo:null,currentInfo:null,productId:"",quantity:1,init:function(){this.productInfo=Object.assign({},mainProductInfo.info);this.currentInfo=Object.assign({},mainProductInfo.info);this.quantity=this.productInfo.moq||1;this.getTotalMoney();if(this.productInfo.sku){this.getSelectionAttrs();this.bindEvents()}},shouldHideAttributeSelector(selectionAttrs){return selectionAttrs.find(item=>item.attrName==="match")||selectionAttrs.length===0||selectionAttrs.length===1&&selectionAttrs[0].values.length<=1},getSelectionAttrs:async function(){try{const res=await kkAjax.get(`/spu/selection-attrs/other?sku=${this.productInfo.sku}`);if(res.code===200&&res.data){this.selectionAttrs=res.data.selectionAttrs||[];this.availableAttrs=res.data.availableAttrs||[];if(this.shouldHideAttributeSelector(this.selectionAttrs)){$("#js-quickbuy-selectedbox").hide();$("#js-view-product-details").hide();return false}this.selectedValues=new Array(this.selectionAttrs.length).fill("");this.calculateCurrentSkuAttrs();this.renderSelects()}}catch(err){console.error("Failed to fetch selection attributes:",err)}},async getProductData(info){this.productInfo=Object.assign({},info);this.productInfo.moq=parseInt(this.productInfo.moq)||1;this.productInfo.mpq=parseInt(this.productInfo.mpq)||1;this.quantity=this.productInfo.moq;this.productInfo.sku=info.skuCode||"";this.productInfo.discountJson=this.productInfo.quantityDiscount||0;$(".js-current-img").attr("src","");$(".js-current-img").attr("src",this.productInfo.image);$(".js-current-input").val(this.productInfo.moq);$("#js-quickbuy-price").text(parseFloat(this.productInfo.price).toFixed(2));if(this.productInfo.salesUnit){$("#js-quickbuy-unit").text("/"+this.productInfo.salesUnit||"")}if(this.productInfo.model){$(".js-current-model").html("Model: "+this.productInfo.model||"")}if(this.productInfo.skuCode==this.currentInfo.sku){$("#js-view-product-details").hide()}else{$("#js-view-product-details").show()}this.getTotalMoney();this.openDisabled()},getTotalMoney:function(){const discountJson=this.productInfo.discountJson||null;const finalPrice=cartFormModule.computed_price(discountJson,this.productInfo.price,this.quantity);$(".js-current-price").html(finalPrice)},calculateCurrentSkuAttrs:function(){if(!this.productInfo.sku||!this.availableAttrs||this.availableAttrs.length===0)return;const currentSkuAttrs=this.availableAttrs.find(item=>item.skuCode===this.productInfo.sku);if(currentSkuAttrs&&currentSkuAttrs.attrs){this.selectedValues=[...currentSkuAttrs.attrs]}},renderSelects:function(){if(!this.selectionAttrs||this.selectionAttrs.length===0)return;let html="";for(let i=0;i<Math.min(2,this.selectionAttrs.length);i++){const attr=this.selectionAttrs[i];html+=`
          <div class="mb-1.5 fb-big:mb-3 last:mb-0 flex flex-col">
            <label class="text-12 w-full text-left text-main">${attr.attrName}:</label>
            <div class="relative w-12r h-8 mt-1.5">
              <select 
                class="quick-buy-select border border-D3DEF1 rounded-sm w-full h-full text-14 font-bold  focus:border-main focus:border-none pl-2 pr-8 fb-big:pr-10 text-main cursor-pointer appearance-none"
                data-attr-name="${attr.attrName}"
                data-attr-index="${i}"
              >
               ${i>0?"<option value=''>Please select</option>":""} 
                ${this.getOptionsHtml(attr,i)}
              </select>
              <div class="pointer-events-none flex absolute right-2 fb-big:right-3 top-0 w-2.5 h-full  items-center justify-center">
                <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto">
                  <path d="M8.12627 5.172L12.5127 0.572266L14 2.14698L7.10895 9.42663L0.032792 2.18874C-0.0211316 2.12483 0.000598849 2.08563 0.032792 2.02002C0.213881 1.64764 1.14508 0.985542 1.40585 0.572265L6.03369 5.25722L6.9999 6.20676L8.12627 5.172Z" fill="#0A2B6F"/>
                </svg>
              </div>
            </div>
          </div>
        `}$("#js-quickbuy-selectedbox").html(html);this.setSelectDefaultValues()},setSelectDefaultValues:function(){if(!this.selectedValues||this.selectedValues.length===0)return;if(this.selectedValues[0]){$(`#js-quickbuy-selectedbox select[data-attr-index="0"]`).val(this.selectedValues[0])}this.updateSecondSelect();if(this.selectedValues.length>1&&this.selectedValues[1]){$(`#js-quickbuy-selectedbox select[data-attr-index="1"]`).val(this.selectedValues[1])}},getOptionsHtml:function(attr,attrIndex){if(!attr||!attr.values)return"";if(attrIndex===0){return attr.values.map(value=>`<option value="${value}">${value}</option>`).join("")}if(attrIndex===1&&this.selectedValues[0]){const availableValues=this.getAvailableValuesForSecondAttr();return attr.values.filter(value=>availableValues.includes(value)).map(value=>`<option value="${value}">${value}</option>`).join("")}return""},getAvailableValuesForSecondAttr:function(){if(!this.availableAttrs||this.availableAttrs.length===0||!this.selectedValues[0]){return[]}return this.availableAttrs.filter(item=>item.attrs&&item.attrs[0]===this.selectedValues[0]).map(item=>item.attrs[1]).filter(Boolean)},getDisabled:function(){$("#js-quickbuy-add-to-cart").prop("disabled",true)},openDisabled:function(){$("#js-quickbuy-add-to-cart").prop("disabled",false)},checkAndRedirectToSku:function(){const requiredSelectionCount=this.selectionAttrs.length;const validSelections=this.selectedValues.filter((val,index)=>{return index<requiredSelectionCount?val&&val!=="":true});if(validSelections.length<requiredSelectionCount){this.getDisabled();return}const matchedSku=this.availableAttrs.find(item=>{if(!item.attrs)return false;for(let i=0;i<requiredSelectionCount;i++){if(i>=item.attrs.length||item.attrs[i]!==this.selectedValues[i]){return false}}return true});if(matchedSku&&matchedSku.skuCode){this.getProductData(matchedSku)}else{this.getDisabled()}},increaseQuantity:function(){if(!this.productInfo)return;const $input=$(".js-current-input");const currentValue=parseInt($input.val());const moq=this.productInfo.moq||1;const mpq=this.productInfo.mpq||1;let newValue;if(currentValue<moq){newValue=moq}else{newValue=currentValue+mpq}const maxQuantity=cartFormModule.maxQuantity;if(newValue>maxQuantity){newValue=maxQuantity;$(".js-quick-plus").prop("disabled",true)}else{$(".js-quick-plus").prop("disabled",false)}$input.val(newValue);$(".js-quick-minus").prop("disabled",false);this.quantity=newValue;this.getTotalMoney()},decreaseQuantity:function(){if(!this.productInfo)return;const $input=$(".js-current-input");const currentValue=parseInt($input.val());const moq=this.productInfo.moq||1;const mpq=this.productInfo.mpq||1;let newValue;if(currentValue<=moq){newValue=moq;$(".js-quick-minus").prop("disabled",true)}else{newValue=currentValue-mpq;if(newValue<moq){newValue=moq;$(".js-quick-minus").prop("disabled",true)}else{$(".js-quick-minus").prop("disabled",false)}}$input.val(newValue);$(".js-quick-plus").prop("disabled",false);this.quantity=newValue;this.getTotalMoney()},bindEvents:function(){const self=this;$(document).on("change",'#js-quickbuy-selectedbox select[data-attr-index="0"]',function(){const selectedValue=$(this).val();self.selectedValues[0]=selectedValue;self.selectedValues[1]="";self.updateSecondSelect();if(selectedValue){self.checkAndRedirectToSku()}else{self.getDisabled()}});$(document).on("change",'#js-quickbuy-selectedbox select[data-attr-index="1"]',function(){const selectedValue=$(this).val();self.selectedValues[1]=selectedValue;if(selectedValue){self.checkAndRedirectToSku()}else{self.getDisabled()}});$("#js-view-product-details").click(function(){if(self.productInfo.sku){window.location.href=`/products/${self.productInfo.sku}`}});$("#js-quickbuy-add-to-cart").click(function(){let $btn=$(this);$btn.find(".js-btn-text").addClass("hidden");$btn.find(".js-btn-loading").removeClass("hidden");const $input=$(".js-current-input");cartFormModule.addToCart({variantId:self.productInfo.variantId,quantity:$input.val()||self.quantity},function(){$btn.find(".js-btn-text").removeClass("hidden");$btn.find(".js-btn-loading").addClass("hidden")})});$(".js-quick-plus").click(function(){self.increaseQuantity()});$(".js-quick-minus").click(function(){self.decreaseQuantity()});$(".js-current-input").on("change",function(){cartFormModule.validateQuantityInput($(this),self.productInfo,function(newQuantity){$(".js-quick-minus").prop("disabled",newQuantity<=self.productInfo.moq);$(".js-quick-plus").prop("disabled",newQuantity>=cartFormModule.maxQuantity);self.quantity=newQuantity;self.getTotalMoney()})})},updateSecondSelect:function(){if(this.selectionAttrs.length<2)return;const $secondSelect=$('#js-quickbuy-selectedbox select[data-attr-index="1"]');if($secondSelect.length===0)return;const availableValues=this.getAvailableValuesForSecondAttr();const attr=this.selectionAttrs[1];let html='<option value="">Please select</option>';if(attr&&attr.values){html+=attr.values.filter(value=>availableValues.includes(value)).map(value=>`<option value="${value}">${value}</option>`).join("")}$secondSelect.html(html)}};productNavBar.init();navQuickBuy.init();let isInitialized=false;function throttle(fn,delay){let timer=null;let lastTime=0;return function(){const now=Date.now();if(now-lastTime>=delay){fn.apply(this,arguments);lastTime=now}}}function handleVisibility(){const quickBuyElement=$("#js-product-quikbuy");const mainPaymentContainer=$(".js-cus-product");const isMainPaymentVisible=mainPaymentContainer.length&&FbIsInViewPort(mainPaymentContainer[0]);const shouldShowQuickBuy=window.innerWidth>1700&&!isMainPaymentVisible;const tidioChat=$("#tidio-chat");if(shouldShowQuickBuy){quickBuyElement.fadeIn();tidioChat.fadeOut();if(!isInitialized){quickBuy.init();isInitialized=true}}else{quickBuyElement.fadeOut();tidioChat.fadeIn()}const $bottomAddCart=$(".js-bottom-addcart");const isBottomCartVisible=$bottomAddCart.is(":visible");if(window.innerWidth<740){if(!isMainPaymentVisible&&!isBottomCartVisible){$bottomAddCart.fadeIn()}else if(isMainPaymentVisible&&isBottomCartVisible){$bottomAddCart.fadeOut()}}else if(window.innerWidth>740){if(isBottomCartVisible){$bottomAddCart.fadeOut()}}const header=$("#shopify-section-header");const isHeaderVisible=header.is(":visible");if(isMainPaymentVisible&&!isHeaderVisible){header.show()}else if(!isMainPaymentVisible&&isHeaderVisible){header.hide()}}handleVisibility();const throttledHandler=throttle(handleVisibility,100);$(window).on("scroll resize",throttledHandler)});